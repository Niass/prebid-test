<html>

<head>
  <title>Bienvenue dans Prebid test</title>
  <meta name="description" content="Testing prebids">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <meta name="keywords" content="Bliink, Saber, Prebid">
  <style>
    .app_gdpr--2k2uB {
      display: none !important;
    }

    .max-width {
      width: 90%;
      max-width: 960px;
      margin: 0 auto;
    }

    .clearfix::after,
    .clearfix::before {
      content: "";
      display: table;
    }

    .clearfix::after {
      clear: both;
    }

    #copy a {
      color: white;
      text-decoration: none;
      border-bottom: 3px dotted white;
    }

    #copy a:hover {
      border-bottom: 3px dotted #4972b2;
    }

    .box-sizing {
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      -ms-box-sizing: border-box;
      box-sizing: border-box;
    }

    body {
      line-height: 1.3em;
      font-size: 1.3em;
    }

    main {
      margin: 0px auto 200px;
      padding: 10px 25px;
      z-index: 0;
      background: white;
    }

    main p {
      width: 90%;
      max-width: 960px;
      margin: 0 auto;
      margin: 30px auto;
      color: #3c5e94;
    }

    footer {
      width: 100%;
      position: fixed;
      z-index: -1;
      bottom: 0;
      background: #2d4770;
      height: 200px;
    }

    footer ul {
      max-width: 300px;
      width: 90%;
      margin: 30px auto;
    }

    footer ul::after,
    footer ul::before {
      content: "";
      display: table;
    }

    footer ul::after {
      clear: both;
    }

    footer ul li {
      float: left;
      text-align: center;
      width: 33.333%;
    }

    footer ul a {
      color: white;
    }

    footer ul a i {
      font-size: 3em;
    }

    footer ul a:hover {
      color: #dbdbdb;
      -webkit-text-shadow: 1px 1px 0 #000;
      -moz-text-shadow: 1px 1px 0 #000;
      text-shadow: 1px 1px 0 #000;
    }

    footer p {
      font-size: 1.7em;
      color: white;
      margin-top: 20px;
      text-align: center;
    }
  </style>
  <script async src="https://www.googletagservices.com/tag/js/gpt.js"></script>
  <script async src="./newprebid.js"></script>
  <script type="text/javascript" src="https://static.adplayer.pro/player/demo.js"></script>
  <script>
    (function (window, document) {
      if (!window.__cmp) {
        window.__cmp = (function () {
          var listen = window.attachEvent || window.addEventListener;
          listen('message', function (event) {
            window.__cmp.receiveMessage(event);
          }, false);

          function addLocatorFrame() {
            if (!window.frames['__cmpLocator']) {
              if (document.body) {
                var frame = document.createElement('iframe');
                frame.style.display = 'none';
                frame.name = '__cmpLocator';
                document.body.appendChild(frame);
              } else {
                setTimeout(addLocatorFrame, 5);
              }
            }
          }
          addLocatorFrame();

          var commandQueue = [];
          var cmp = function (command, parameter, callback) {
            if (command === 'ping') {
              if (callback) {
                callback({
                  gdprAppliesGlobally: !!(window.__cmp && window.__cmp.config && window.__cmp.config.storeConsentGlobally),
                  cmpLoaded: false
                });
              }
            } else {
              commandQueue.push({
                command: command,
                parameter: parameter,
                callback: callback
              });
            }
          }
          cmp.commandQueue = commandQueue;
          cmp.receiveMessage = function (event) {
            var data = event && event.data && event.data.__cmpCall;
            if (data) {
              commandQueue.push({
                callId: data.callId,
                command: data.command,
                parameter: data.parameter,
                event: event
              });
            }
          };
          cmp.config = {
            logging: 'debug',
          }
          console.log('bliink cmp', cmp.config, commandQueue)
          return cmp;
        }());
        var t = document.createElement('script');
        t.async = false;
        t.src = 'https://acdn.adnxs.com/cmp/cmp.bundle.js';
        var tag = document.getElementsByTagName('head')[0];
        tag.appendChild(t);
      }
    })(window, document);
    window.__cmp('showConsentTool');
  </script>

  <script>
    var PREBID_TIMEOUT = 700;
    var FAILSAFE_TIMEOUT = 2500;
    var tempTag = false;
    var domId = false;
    const urlParams = new URLSearchParams(window.location.search);
    var invokeVideoPlayer = function (url, id) {
      tempTag = url;
      domId = id;
    }
    const sticky = urlParams.get('sticky');
    var videoAdUnit = [
      {
        code: 'video1',
        mediaTypes: {
          video: {
            context: 'instream',
            playerSize: [640, 480],
            mimes: ['video/mp4'],
            protocols: [1, 2, 3, 4, 5, 6, 7, 8],
            playbackmethod: [2],
            skip: 1
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              tagId: '8121',
              placement: 'video',
            }
          },
        ]
      },
      {
        code: 'video2',
        mediaTypes: {
          video: {
            context: 'instream',
            playerSize: [640, 480],
            mimes: ['video/mp4'],
            protocols: [1, 2, 3, 4, 5, 6, 7, 8],
            playbackmethod: [2],
            skip: 1
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              tagId: '8123',
              placement: 'video',
            }
          },
        ]
      },
    ];


    var adUnits = [

      {
        code: 'test1',
        mediaTypes: {
          banner: {
            sizes: [[300, 100], [300, 600]]
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              placement: 'banner',
              tagId: '290'
            }
          }
        ]
      },
      {
        code: 'test991',
        mediaTypes: {
          banner: {
            sizes: [[300, 250], [300, 600]]
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              placement: 'banner',
              tagId: '991'
            }
          }
        ]
      },
      {
        code: 'test333',
        mediaTypes: {
          banner: {
            sizes: [[350, 116], [300, 600]]
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              placement: 'banner',
              tagId: '890'
            }
          }
        ]
      },
      {
        code: 'test11',
        mediaTypes: {
          banner: {
            sizes: [[250, 200], [500, 350], [300, 600]]
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              placement: 'banner',
              tagId: '1000'
            }
          }
        ]
      },
      {
        code: 'test113',
        mediaTypes: {
          banner: {
            sizes: [[250, 200], [500, 350], [300, 600]]
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              placement: 'banner',
              tagId: '550'
            }
          }
        ]
      },
      {
        code: 'test111',
        mediaTypes: {
          banner: {
            sizes: [[320, 100], [300, 600]]
          }
        },
        bids: [
          {
            bidder: 'bliink',
            params: {
              placement: 'banner',
              tagId: '777'
            }
          }
        ]
      },
      // {
      //   code: 'test2',
      //   mediaTypes: {
      //     banner: {
      //       sizes: [[970, 90], [300, 600]]
      //     }
      //   },
      //   bids: [
      //     {
      //       bidder: 'bliink',
      //       params: {
      //         placement: 'banner',
      //         tagId: '210'
      //       }
      //     }
      //   ]
      // },
      // {
      //   code: 'test3',
      //   mediaTypes: {
      //     banner: {
      //       sizes: [[300, 250], [600, 300]]
      //     }
      //   },
      //   bids: [
      //     {
      //       bidder: 'bliink',
      //       params: {
      //         placement: 'banner',
      //         tagId: '810'
      //       }
      //     }
      //   ]
      // },
      // {
      //   code: 'test4',
      //   mediaTypes: {
      //     banner: {
      //       sizes: [[320, 50],[720, 90], [300, 600]]
      //     }
      //   },
      //   bids: [
      //     {
      //       bidder: 'bliink',
      //       params: {
      //         placement: 'banner',
      //         tagId: sticky === 'native' ? '850' : '811'
      //       }
      //     }
      //   ]
      // },
      // {
      //   code: 'test5',
      //   mediaTypes: {
      //     banner: {
      //       sizes: [[250, 200], [800, 400], [300, 600]]
      //     }
      //   },
      //   bids: [
      //     {
      //       bidder: 'bliink',
      //       params: {
      //         placement: 'banner',
      //         tagId: sticky === 'banner' ? '812' : '813'
      //       }
      //     }
      //   ]
      // },
      // {
      //   code: 'test15',
      //   mediaTypes: {
      //     banner: {
      //       sizes: [[250, 200],[800, 400], [300, 600]]
      //     }
      //   },
      //   bids: [
      //     {
      //       bidder: 'bliink',
      //       params: {
      //         placement: 'banner',
      //         tagId: '218'
      //       }
      //     }
      //   ]
      // },
      // {
      //   code: 'test6',
      //   mediaTypes: {
      //     banner: {
      //       sizes: [[320, 50], [300, 600]]
      //     }
      //   },
      //   bids: [
      //     {
      //       bidder: 'bliink',
      //       params: {
      //         placement: 'banner',
      //         tagId: '813'
      //       }
      //     }
      //   ]
      // },
    ];

    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];

  </script>

  <script>
    var googletag = googletag || {};
    googletag.cmd = googletag.cmd || [];
    googletag.cmd.push(function () {
      googletag.pubads().disableInitialLoad();
    });
    function renderAllAdUnits() {
      // renderVideo()
      var winners = pbjs.getHighestCpmBids();
      console.log('winners', winners)
      for (var i = 0; i < winners.length; i++) {
        if (winners[i].mediaType === 'video') {
          console.log('rendering video***', winners[i])
          renderVideo(winners[i])
          renderOne(winners[i]);
        } else {
          renderOne(winners[i]);

        }
      }
    }
    function renderOne(winningBid) {
      if (winningBid && winningBid.adId) {
        var div = document.getElementById(winningBid.adUnitCode);
        if (div) {
          let iframe = document.createElement('iframe');
          iframe.frameBorder = '0';
          div.appendChild(iframe);
          var iframeDoc = iframe.contentWindow.document;
          pbjs.renderAd(iframeDoc, winningBid.adId);
        }
      }

    }
    function renderVideo(bid) {
      var videoUrl_ = bid.vastUrl;
      console.log('videoUrl_', videoUrl_)
      invokeVideoPlayer(videoUrl_, bid.adUnitCode);
    }

    pbjs.que.push(function () {
      pbjs.addAdUnits(adUnits);
      // pbjs.addAdUnits(videoAdUnit);
      pbjs.setConfig({
        "schain": {
          "validation": "strict",
          "config": {
            "ver": "1.0",
            "complete": 1,
            "nodes": [
              {
                "asi": "indirectseller.com",
                "sid": "00001",
                "hp": 1
              }
            ]
          }
        },
        cache: {
          url: 'https://prebid.adnxs.com/pbc/v1/cache'
        },
        "consentManagement": {
          "cmpApi": "static",
          "consentData": {
            "getTCData": {
              "tcString": "CPYzd0APYzd0AAHABBENCOCsAP_AAAAAAAAAIutf_Xb3_j-5t0eY1f9_7-0zjhfdp-8N3f_X_L8X_2M7vF36pq4KuR4Eu3LBIQdlHOHcTUmw6okVrzPsbk2cr7NKJ7PEmnMbe2dYGH9n93T-ZKY7-_77-_f-f53--_b_V_997bn9_9_P_9v8_v__4AAACQkAGAAIIuhoAMAAQRdEQAYAAgi6KgAwABBF0ZABgACCLo6ADAAEEXSEAGAAIIukoAMAAQRdKQAYAAgi6AAA.f_gAAAAAAAAA",
              "cmpId": 10,
              "cmpVersion": 23,
              "tcfPolicyVersion": 2,
              "gdprApplies": true,
              "cmpStatus": "loaded",
              "eventStatus": "tcloaded",
              "purpose": {
                "consents": {
                  "1": true,
                  "2": true
                }
              },
              "vendor": {
                "consents": {
                  // add your GVL ID here and set to true to give consent within pbjs
                  "658": true,     // Bliink
                }
              }
            }
          }
        },
        userSync: {
          iframeEnabled: true,
          userIds: [{
            name: "sharedId",
            storage: {
              type: "cookie",
              name: `_pubcid`,         // create a cookie with this name
              expires: 365             // expires in 1 years
            }
          }, {
            name: "criteo",
          }, {
            name: "pubCommonId",
            storage: {
              type: "cookie",
              name: "_pubcid",         // create a cookie with this name
              expires: 365             // expires in 1 years
            }
          }, {
            name: 'hadronId',
            storage: {
              name: 'hadronId',
              type: 'html5'
            }
          }],
          filterSettings: {
            iframe: {
              bidders: '*',
              filter: 'include',
            },
          },
        },
        pubcid: {
          enable: false
        }
      });
      pbjs.requestBids({
        bidsBackHandler: renderAllAdUnits,
        timeout: PREBID_TIMEOUT
      });
    });

    function sendAdserverRequest() {
      console.log('sendAdserverRequest called')
      const bids = pbjs.getHighestCpmBids('test')
      const bidsResp = pbjs.getBidResponses()
      console.log('bidsResp', bidsResp)
      for (const property in bidsResp) {
        const adm = bidsResp[property].bids[0]?.ad
        console.log(`***${property}: ${bidsResp[property]}`);
        console.log('adm*', adm, property)
        document.querySelector(`#${property}`).insertAdjacentHTML('beforeend', adm)
      }
      // console.log('bids_', bidsResp)
      // console.log('winner', bids[0], bids[0]?.ad)
    }

    setTimeout(function () {
      // sendAdserverRequest();
      console.log('timeout in main pbjs fired');
    }, FAILSAFE_TIMEOUT);

  </script>
  <script>
    googletag.cmd.push(function () {
      googletag.defineSlot('/19968336/header-bid-tag-0', [[300, 250], [300, 600]], 'div-gpt-ad-1460505748561-0').addService(googletag.pubads());

      googletag.pubads().enableSingleRequest();
      googletag.enableServices();
    });
  </script>
  <style>
    .ads {
      width: 650px;
      height: 260px;
      background-color: green;
      margin: 20px;
    }

    body {
      margin: 0;
      /* padding: 25px; */
    }

    iframe body {
      margin: 0;
    }

    .article {
      margin: 20px 0;
    }

    .navbar {
      overflow: hidden;
      background-color: #333;
      position: fixed;
      /* Set the navbar to fixed position */
      top: 0;
      /* Position the navbar at the top of the page */
      width: 100%;
      /* Full width */
    }

    /* Links inside the navbar */
    .navbar a {
      float: left;
      display: block;
      color: #f2f2f2;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
    }

    /* Change background on mouse-over */
    .navbar a:hover {
      background: #ddd;
      color: black;
    }

    /* Main content */
    main {
      margin-top: 80px;
      /* Add a top margin to avoid content overlay */
    }
  </style>
</head>

<body>
  <header>
    <nav role='navigation' class="navbar">
      <a href="#">Home</a>
      <a href="#">About</a>
      <a href="#">Clients</a>
      <a href="#">Contact Us</a>
  </header>
  <main>
    <h2>Prebid.js Test</h2>
    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet
      dolore magna aliquam erat volutpat. Ut wisi enim ad minim veniam, quis nostrud exerci tation ullamcorper suscipit
      lobortis nisl ut aliquip ex ea commodo consequat. Duis autem vel eum iriure dolor in hendrerit in vulputate velit
      esse molestie consequat, vel illum dolore eu feugiat nulla facilisis at vero eros et accumsan et iusto odio
      dignissim qui blandit praesent luptatum zzril delenit augue duis dolore te feugait nulla facilisi. Nam liber
      tempor cum soluta nobis eleifend option congue nihil imperdiet doming id quod mazim placerat facer possim assum.
      Typi non habent claritatem insitam; est usus legentis in iis qui facit eorum claritatem. Investigationes
      demonstraverunt lectores legere me lius quod ii legunt saepius. Claritas est etiam processus dynamicus, qui
      sequitur mutationem consuetudium lectorum. Mirum est notare quam littera gothica, quam nunc putamus parum claram,
      anteposuerit litterarum formas humanitatis per seacula quarta decima et quinta decima. Eodem modo typi, qui nunc
      nobis videntur parum clari, fiant sollemnes in futurum.</p>
    <div class="article">Article</div>
    <div id='test1'></div>
    <div class="article">Article</div>
    <div id='test11'></div>
    <div class="article">Article</div>
    <div id='test111'></div>
    <div class="article">Article</div>
    <div id='test991'></div>
    <div class="article">Article</div>
    <div id='test3'></div>
    <div class="article">Article</div>
    <div id='test4'></div>
    <div class="article">Article</div>
    <div id='test333'></div>
    <div style="margin-bottom: 130px;"></div>
    <div id='test15'></div>
    <div class="article">Article</div>
    <div id='test6'></div>
    <div class="article">Article</div>
    <!-- <div id="video1" style="width:640px; height:480px;"></div> -->
    <div class="article">Article</div>
    <div style="margin-bottom: 30px;"></div>
    <div class="article">Article</div>
    <div style="margin-top: 75vh; margin-bottom: 15vh;" id='test113'></div>
    <!-- <div id="video2" style="width:640px; height:480px;"></div> -->
    <div class="article">Article</div>
    </div>
    <div id="div-test">

    </div>
  </main>
  <footer>
    <ul>
      <li><a href=""><i class="fa fa-twitter"></i></a></li>
      <li><a href=""><i class="fa fa-facebook"></i></a></li>
      <li><a href=""><i class="fa fa-google-plus"></i></a></li>
    </ul>
    <p id="copy">By <a href="www.bddesign.es" title="BD Design">BD Design</a></p>
  </footer>


</body>

</html>