<!DOCTYPE html>
<html>
    <head>
        <title>Prebid Display/Video Merged Auction with Adloox Integration</title>

        <script async src="./prebid.js"></script>

<script type="text/javascript" src="https://static.adplayer.pro/player/demo.js"></script>
<script>
  var pbjs = pbjs || {};
  pbjs.que = pbjs.que || [];

  // define invokeVideoPlayer in advance in case we get the bids back from prebid before the entire page loads

  var tempTag = false;
  var invokeVideoPlayer = function(url) {
      tempTag = url;
  }

  var videoAdUnit = {
      code: 'video1',
      mediaTypes: {
          video: {
                  context: 'instream',
                  playerSize: [640, 480],
                  mimes: ['video/mp4'],
                  protocols: [1, 2, 3, 4, 5, 6, 7, 8],
                  playbackmethod: [2],
                  skip: 1
          }
      },
      bids: [{
          bidder: 'bliink',
          params: {
              tagId: '8121',
              placement: 'video',

          }
      }]
  };

  pbjs.que.push(function() {
      pbjs.addAdUnits(videoAdUnit); // add your ad units to the bid request

      pbjs.setConfig({
          debug: true,
          cache: {
              url: 'https://prebid.adnxs.com/pbc/v1/cache'
          }
      });

      pbjs.requestBids({
          bidsBackHandler: function(bids) {
              var videoUrl = pbjs.adServers.dfp.buildVideoUrl({
                  adUnit: videoAdUnit,
                  params: {
                      iu: '/19968336/prebid_cache_video_adunit',
                      cust_params: {
                          section: 'blog',
                          anotherKey: 'anotherValue'
                      },
                      output: 'vast'
                  }
              });
              invokeVideoPlayer(videoUrl);
            }
        });
    });
    
</script>

</head>
<body>
    <!--player div-->
    <div id="playerContainerADP" style="width:640px; height:480px;"></div>
    <script type="text/javascript">
        invokeVideoPlayer = function(url) {
      console.log('videoUrl', url)
      const bids = pbjs.getHighestCpmBids()
      console.log('bids high', bids);
      const bidVideo = bids.find(bid=>bid.mediaType === 'video')
      console.log('bidVideo', bidVideo)
        AdPlayerPro('playerContainerADP').setup({
          "file": "https://static.adplayer.pro/video/640.mp4",
          "width": 640,
          "height": 480,
          "autoStart": true,
          "muted": true,
          "advertising": {
            "tag": 'https://securepubads.g.doubleclick.net/gampad/ads?env=vp&gdfp_req=1&output=vast&unviewed_position_start=1&correlator=1656138030035&sz=640x480&url=https%3A%2F%2Fdocs.prebid.org%2Fexamples%2Fvideo%2Finstream%2Fadplayerpro%2Fpb-ve-adplayerpro.html&iu=/19968336/prebid_cache_video_adunit&cust_params=hb_uuid%3D3e158b22-1ffe-42c1-a2bb-022ffe1f1a76%26hb_cache_id%3D3e158b22-1ffe-42c1-a2bb-022ffe1f1a76%26hb_cache_host%3Dprebid.adnxs.com%26hb_format%3Dvideo%26hb_size%3D640x480%26hb_pb%3D5.00%26hb_adid%3D39ff31c97e5dac%26hb_bidder%3Dbliink%26hb_cache_host_appnex%3Dprebid.adnxs.com%26hb_uuid_bliink%3D3e158b22-1ffe-42c1-a2bb-022ffe1f1a76%26hb_format_bliink%3Dvideo%26hb_size_bliink%3D640x480%26hb_pb_bliink%3D5.00%26hb_adid_bliink%3D39ff31c97e5dac%26hb_bidder_bliink%3Dbliink%26hb_source%3Dclient%26hb_adomain%3D%26section%3Dblog%26anotherKey%3DanotherValue'
          }
        });
  };

  if (tempTag) {
    invokeVideoPlayer(tempTag);
    tempTag = false;
  }
  </script>
    </body>
</html>
